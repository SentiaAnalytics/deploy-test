machine:
  node:
    version: 0.12.0
  services:
    - docker


dependencies:
  pre:
    - apt-get update && apt-get install -y -qq --no-install-recommends wget unzip python php5-mysql php5-cli php5-cgi openjdk-7-jre-headless openssh-client python-openssl && apt-get clean
    - wget https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.zip && unzip google-cloud-sdk.zip && rm google-cloud-sdk.zip
    - export CLOUDSDK_PYTHON_SITEPACKAGES=1
    - google-cloud-sdk/install.sh --usage-reporting=true --path-update=true --bash-completion=true --rc-path=/.bashrc --disable-installation-options
    - google-cloud-sdk/bin/gcloud --quiet components update pkg-go pkg-python pkg-java preview alpha beta app
    - google-cloud-sdk/bin/gcloud --quiet config set component_manager/disable_update_check true
    - mkdir /.ssh
    - export PATH=/google-cloud-sdk/bin:$PATH
    - export HOME=/
  override:
    - docker info
    - docker build -t cullophid/hello-world .

test:
  override:
    - docker run -d -p 80:80 cullophid/hello-world;
    - sleep 5
    - curl --retry 10 --retry-delay 5 -v http://localhost

deployment:
  production:
    branch: master
    commands:
    - docker push cullophid/hello-world
